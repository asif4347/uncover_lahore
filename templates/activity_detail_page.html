{% extends 'base.html' %}
{% load static %}
{% block main %}

    <section class="parallax-window" data-parallax="scroll" data-image-src="{{ activity.background_image.url }}"
             data-natural-width="1400" data-natural-height="470">
        <div class="parallax-content-2">
            <div class="container">
                <div class="row">
                    <div class="col-md-8">
                        <h1>{{ activity.title }}</h1>
                        <span>{{ activity.date_time }}</span>
                    </div>
                    <div class="col-md-4">
                        <div id="price_single_main">
                            from/per person <span><sup>PKR</sup>{{ activity.price }}</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- End section -->

    <main style="margin-bottom: 355px;">

        <!-- End Position -->

        <div class="collapse" id="collapseMap">
            <div id="map" class="map"></div>
        </div>
        <!-- End Map -->

        <div class="container margin_60">
            <div class="row">
                <div class="col-lg-8" id="single_tour_desc">


                    <p class="d-none d-md-block d-block d-lg-none"><a class="btn_map" data-toggle="collapse"
                                                                      href="#collapseMap" aria-expanded="false"
                                                                      aria-controls="collapseMap"
                                                                      data-text-swap="Hide map"
                                                                      data-text-original="View on map">View on map</a>
                    </p>
                    <!-- Map button for tablets/mobiles -->

                    <div class="row">
                        <div class="col-lg-3">
                            <h3>Description</h3>
                        </div>
                        <div class="col-lg-9">
                            <p>
                                {{ activity.description }}
                            </p>
                            <p>
                                {{ activity.remember }}

                            </p>
                            <p>
                                {{ activity.experts }}
                            </p>
                            <!-- End row  -->
                        </div>
                    </div>
                    <hr>
                    <div class="row">
                        <div class="col-lg-3">
                            <h3>Available Seats</h3>
                        </div>
                        <div class="col-lg-9">
                            <h2>
                                {{ activity.seats }}
                            </h2>

                        </div>
                    </div>
                    <hr>

                    <div class="row">
                        <div class="col-lg-3">
                            <h3>Location</h3>
                        </div>
                        <div class="col-lg-9">
                            <div class="table-responsive">
                                <h3>{{ activity.location }}</h3>
                            </div>

                        </div>
                    </div>

                    <hr>


                </div>
                <!--End  single_tour_desc-->

                <aside class="col-lg-4">
                    <p class="d-none d-xl-block d-lg-block d-xl-none">
                        <a class="btn_map" data-toggle="collapse" href="#collapseMap" aria-expanded="false"
                           aria-controls="collapseMap" data-text-swap="Hide map" data-text-original="View on map">View
                            on
                            map</a>
                    </p>
                    <div class="box_style_1 expose">
                        <h3 class="inner">- Booking -</h3>
                        <div class="row">
                            <div class="col-sm-6">
                                <div class="form-group">
                                    <label><i class="icon-calendar-7"></i> Select a date</label>
                                    <input class="date-pick form-control" data-date-format="M d, D" type="text"
                                           value="Aug 17, Sat">
                                </div>
                            </div>
                            <div class="col-sm-6">
                                <div class="form-group">
                                    <label><i class=" icon-clock"></i> Time</label>
                                    <input class="time-pick form-control" value="12:00 AM" type="text">
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-6">
                                <div class="form-group">
                                    <label>Adults</label>
                                    <div class="numbers-row">
                                        <input type="text" value="1" id="adults" class="qty2 form-control"
                                               name="quantity">
                                        <div class="inc button_inc">+</div>
                                        <div class="dec button_inc">-</div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="form-group">
                                    <label>Children</label>
                                    <div class="numbers-row">
                                        <input type="text" value="0" id="children" class="qty2 form-control"
                                               name="quantity">
                                        <div class="inc button_inc">+</div>
                                        <div class="dec button_inc">-</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <br>
                        <table class="table table_summary">
                            <tbody>
                            <tr>
                                <td>
                                    Adults
                                </td>
                                <td class="text-right">
                                    2
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    Children
                                </td>
                                <td class="text-right">
                                    0
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    Total amount
                                </td>
                                <td class="text-right">
                                    3x $52
                                </td>
                            </tr>
                            <tr class="total">
                                <td>
                                    Total cost
                                </td>
                                <td class="text-right">
                                    $154
                                </td>
                            </tr>
                            </tbody>
                        </table>
                        <a class="btn_full" href="http://www.ansonika.com/citytours/cart.html">Book now</a>
                        <a class="btn_full_outline" data-toggle="modal" data-target="#myModal"
                           href="javascript:void (0)"><i class=" icon-heart"></i> Add
                            to Schedule</a>
                    </div>
                    <!--/box_style_1 -->

                    <div class="box_style_4">
                        <i class="icon_set_1_icon-90"></i>
                        <h4><span>Book</span> by phone</h4>
                        <a href="tel://004542344599" class="phone">+45 423 445 99</a>
                        <small>Monday to Friday 9.00am - 7.30pm</small>
                    </div>

                </aside>
            </div>
            <!--End row -->
        </div>
        <!--End container -->

        <div id="overlay"></div>
        <!-- Mask on input focus -->

        <!-- Modal -->


    </main>
    <!-- End main -->
    <div class="modal fade" id="myModal" role="dialog">
        <div class="modal-dialog">

            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">

                    <h4 class="modal-title pull-left">Add Activity To schedule</h4>
                    <button type="button" class="close pull-right" data-dismiss="modal">&times;</button>
                </div>
                <div class="modal-body">
                    <form id="schedule" action="" method="post">
                        {% csrf_token %}
                        <input name="activity_id" hidden value="{{ activity.id }}">
                        <input name="date_time" placeholder="Date Time" type="datetime-local" class="form-control"><br>
                        <textarea name="description" class="form-control" placeholder="Description"></textarea><br>
                        <button class="btn btn-dark"><i class="fa fa-spin"></i>Submit</button>
                    </form>
                    <i id="schedule-msg" style="color: green"></i>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
            </div>

        </div>
    </div>
    <script>
        $('.modal-body').on('submit', '#schedule', function () {
            var msg = '#schedule-msg'
            var form = $(this)
            var url = '/main-api/api/add-schedule/'
            console.log(form)
            post_form(form, url, msg)

            return false;
        })

        function post_form(form, url, msg) {
            var user = localStorage.getItem('user')
            if (user) {
                $.ajax({
                    url: url,
                    type: 'post',
                    dataType: 'json',
                    data: form.serialize(),
                    headers: {"Authorization": 'JWT ' + localStorage.getItem('token')},
                    success: function (data) {
                        console.log(data)
                        $(msg).html(data.message)
                        $(msg).css('color', 'green')
                    },
                    error: function (err) {
                        console.log(err)
                        $(msg).html('Server error')
                        $(msg).css('color', 'red')
                    }
                })
            } else {
                window.location.replace('/login')
            }
        }
    </script>

{% endblock %}